#################################################
# ###                                       ### #
# ### Epics database for	            ### #
# ### SCAN System	                    ### #
# ###                                       ### #
# ### author: D. Hampai - M. Montis         ### #
# ###                                       ### #
# ### Ref 1.0; 2025-12-04                   ### #
#################################################
#
#
record(ai, $(user):status) {
	field(DESC, "for test")
	field(VAL, "0")
	field(PINI, "YES")
}
record(stringin, $(user):state) {
	field(DESC, "Actual State")
	field(VAL, "Idle")
	field(PINI, "YES")
}
record(stringin, $(user):experiment) {
	field(DESC, "Name Experiment")
	field(VAL, "$(user)")
	field(PINI, "YES")
}
record(ai, "$(user):total_points") {
        field(DESC, "Total Number Steps")
        field(VAL, "0")
        field(PINI, "YES")
}
record(ai, "$(user):current_point") {
        field(DESC, "General Step Iteration")
        field(VAL, "0")
	field(PINI, "YES")
}
record(ai, "$(user):scan_progress") {
	field(DESC, "Scan progress %")
	field(PREC, "1")
	field(HOPR, "100")
	field(LOPR, "0")
	field(EGU, "%")
}
record(ai, "$(user):scan_busy") {
	field(DESC, "Scan busy")
	field(VAL, "0")
	field(PINI, "YES")
}
record(ao, "$(user):scan_pause") {
        field(DESC, "Scan in Pause")
        field(VAL, "0")
        field(PINI, "YES")
}
record(ao, "$(user):scan_restart") {
        field(DESC, "Restart Scan")
        field(VAL, "0")
        field(PINI, "YES")
}
record(ao, "$(user):scan_abort") {
        field(DESC, "Abort Scan")
        field(VAL, "0")
        field(PINI, "YES")
}
#####
#	Save Path 
#####
record(stringout, $(user):scan:filepath) {
	field(DESC, "Output file path")
	field(VAL, "temp/data")
	field(PINI, "YES")
}
record(stringout, $(user):server:name) {
	field(DESC, "Name Server")
	field(VAL, "$(server)")
	field(PINI, "YES")
}

#####
#       Scan Parameters
#####
record(ao, $(user):num_motor) {
	field(DESC, "Number of Motors")
	field(VAL, "1")
	field(PINI, "YES")
	field(OUT, "$(user):motorindex")
	field(FLNK, "$(user):motorindex")
}
record(dfanout, $(user):motorindex) {
	field(SELM, "0")
	field(SELL, "$(user):num_motor")
	field(OUTA, "$(user):start.NELM")
	field(OUTB, "$(user):end.NELM")
	field(OUTC, "$(user):step.NELM")
	field(OUTD, "$(user):motor.NELM")
}
record(ao, $(user):num_detector) {
        field(DESC, "Number of Detectors")
        field(VAL, "1")
        field(PINI, "YES")
        field(OUT, "$(user):detectorindex")
        field(FLNK, "$(user):detectorindex")
}
record(dfanout, $(user):detectorindex) {
        field(SELM, "0")
        field(SELL, "$(user):num_detector")
        field(OUTA, "$(user):detector.NELM")
}
#
#
#
record(subArray, $(user):start) {
        field(DESC, "Start point scanning")
	field(NELM, "20")
	field(MALM, "20")
	field(INDX, "0")
        field(FTVL, "SHORT")
        field(PREC, "3")
}
record(subArray, $(user):end) {
        field(DESC, "End point scanning")
        field(NELM, "20")
        field(MALM, "20")
        field(INDX, "0")
        field(FTVL, "SHORT")
        field(PREC, "3")
}
record(subArray, $(user):step) {
        field(DESC, "Step scanning")
        field(NELM, "20")
        field(MALM, "20")
        field(INDX, "0")
        field(FTVL, "SHORT")
        field(PREC, "3")
}
#####
#	Definition Motor
#####
record(subArray, $(user):motor) {
        field(DESC, "Name IOC motors")
        field(NELM, "20")
        field(MALM, "20")
        field(INDX, "0")
        field(FTVL, "STRING")
        field(PREC, "3")
}
#	List Motor Commands
record(waveform, $(user):motor_command) {
        field(DESC, "List Motor Command")
        field(NELM, "6")
        field(FTVL, "STRING")
	field(INP, [setmr,setma,reqmoving,moving,reqpos,pos])
}
#####
#	Definition Detector
#####
record(subArray, $(user):detector) {
        field(NELM, "20")
        field(MALM, "20")
        field(INDX, "0")
        field(FTVL, "STRING")
        field(PREC, "3")
}
#	List Detector Commands
record(waveform, $(user):detector_command) {
        field(DESC, "List Detector Command")
        field(NELM, "6")
        field(FTVL, "STRING")
        field(INP, [reqstart,reqdata,data,reqready,ready,type])
}
#
#	PV test
#
#record(bo, $(user):reqtestpv) {
#	field(DESC, "start test pv")
#	field(FLNK, "$(user):testpv")
#	field(PINI, "NO")
#}
#record(stringout, $(user):nametestpv_1) {
#	field(DESC, "pv req to trace")
#	field(VAL, "mm4006_1_1_1:reqpos")
#	field(PINI, "YES")
#}
#record(stringout, $(user):nametestpv_2) {
#        field(DESC, "pv resp to trace")
#        field(VAL, "mm4006_1_1_1:reqpos")
#        field(PINI, "YES")
#}
##record(seq, $(user):testpv) {
#record(dfanout, $(user):testpv) {
#	field(DESC, "comunicate with the PV")
#	field(OUTA, "$(user):nametestpv_1 NPP")
#	field(OUTB, "$(user):nametestpv_2 NPP")
##	field(DOl0, "1")
##	field(INP0, "$(user):nametestpv_1 CP")
##	field(LNK0, "$(user):testpv:exec1 PP")
##	field(LNK0, "$(user):nametestpv_1.VAL")
##	field(DO1, "1")
##	field(DLY1, "0.5")
##        field(INP1, "$(user):nametestpv_2 CP")
##        field(LNK1, "$(user):testpv:exec2 PP")
##	field(LNK1, "$(user):nametestpv_2")
#}
